$(function(){function n(){ns.loadHide(),c.show()}function a(){function n(){if(e>i)return!1;e==i&&g.show(),a.eq(e).addClass("show"),e++,setTimeout(n,100)}var a=($(".linebox"),$(".line")),i=a.length,e=0;n()}function i(){var n=r.not(".fall"),a=n.length,i=Math.floor(Math.random()*a);n.removeClass("appleShake").eq(i).addClass("appleShake")}function e(){ns.log({conType:"input",confirm:function(){if(ns.ajaxLock)return!1;var n=$("#ns_dialog_name").val(),a=$("#ns_dialog_tel").val();if(!ns.check.name(n))return!1;if(!ns.check.tel(a))return!1;ns.load(),ns.ajaxLock=!0;var i={action:"reg",name:n,active:active,tel:a,openid:openid},e=this,t=function(i){ns.loadHide(),ns.ajaxLock=!1,ns.tip(i.errmsg),i&&0==i.errcode&&(y=!0,d.html(T=n),f.html(M=a),e.hide())};ns.ajax(i,t)}})}function t(){s()}function s(){if(ns.ajaxLock)return!1;setTimeout(function(){ns.ajaxLock=!1},2500),$(".fall").remove();var n="";ns.tip("获取成功！"),n="恭喜您获得<br>礼物",L=!0,x.html(n);var i=$(".apple"),e=Math.floor(Math.random()*i.length);i.eq(e).addClass("appleShake"),setTimeout(function(){i.eq(e).addClass("fall").append(q),setTimeout(function(){a()},700)},1500)}function l(){if(ns.ajaxLock)return!1;ns.load(),ns.ajaxLock=!0;var n={action:"queryDetailList",active:active,openid:openid},a=function(n){if(ns.loadHide(),ns.ajaxLock=!1,n&&0==n.errcode){L=!1;var a=n.list,i=a.length,e="",t="",s=0;if(i>0){for(var l=0;l<i;l++)0!=a[l].gift&&(s=1,t="1"==a[l].exchange?'<span class="gift_btn">已兑换</span>':'<span class="gift_btn gift_btn_show"><img src="img/a3.png"></span>',e+='<li data-id="'+a[l].oid+'"><span class="gift_name to_e">'+C[a[l].gift].name+"</span>"+t+"</li>");0==s&&(e+='<li class="t_c">您还没有中奖呢！继续努力吧！</li>')}else e+='<li class="t_c">您还没有中奖呢！继续努力吧！</li>';u.show().find("ul").html(e)}};ns.ajax(n,a)}function o(n){var a=$(this),i=k.val();if(ns.check.empty(i,"请输入兑换密码！"))return!1;if(ns.ajaxLock)return!1;ns.load(),ns.ajaxLock=!0;var e={action:"giftExchange",oid:n,active:active,pwd:i},t=function(n){ns.loadHide(),ns.ajaxLock=!1,ns.tip(n.errmsg),0==n.errcode&&(m.hide(),a.append('<span class="gift_btn">已兑换</span>').find(".gift_btn_show").remove())};ns.ajax(e,t)}ns.load();var c=(ns.loadImgs({sources:{bg:"bg.jpg",title:"title.png",tree:"tree.png",apple1:"apple1.png",apple2:"apple2.png",btn1:"btn1.png",btn2:"btn2.png",btn3:"btn3.png"},dir:"img/",progress:function(){ns.load(this.percent)},end:n}),$("#main")),r=$(".apple"),d=$("#myName"),f=$("#myTel"),p=$(".treebox"),g=$(".giftbox"),h=($("#share"),$("#mygift")),u=$(".mygift"),m=$(".exchange"),v=$(".close"),k=($(".exchange .gift_name"),$("#pwd")),_=$("#pwd_go"),x=$("#gift"),b=$(".btn_goMyGift"),w=$(".btn_close"),j=r.length,L=!0,y=!1,C=[],T="",M="",q='<div class="linebox"><div class="line line1"></div><div class="line line2"></div><div class="line line3"></div><div class="line line4"></div><div class="line line5"></div></div>';!function(){function n(i){if(i&&r.removeClass("show appleShake fall"),!(a.length>0))return r.addClass("ining"),!1;var e=Math.floor(Math.random()*a.length);r.eq(a[e]).addClass("show"),a.splice(e,1),setTimeout(function(){n()},150)}for(var a=[],i=0;i<j;i++)a[i]=i;n()}();window.setInterval(i,2500);p.on(click,t),ns.shake(t),w.on(click,function(){g.hide()}),b.on(click,function(){g.hide(),h.trigger(click)}),h.on(click,function(){y?L?l():u.show():e()}),u.on(click,".gift_btn_show",function(){var n=($(this),$(this).parents("li"));id=n.data("id"),name=n.find(".gift_name").html(),m.show().find(".gift_name").html(name),_.on(click,function(){o.call(n,id)})}),v.on(click,function(){var n=$(this).parents(".box_cl");n.hide(),n.hasClass("mygift")&&(getAppleTimes=0)}),ns.addShare("#share")});