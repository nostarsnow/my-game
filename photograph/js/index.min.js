$(function(){function C(){y.html((100*B.progress).toFixed(2)+"%").width((100*B.progress).toFixed(2)+"%")}function D(){y.parent().hide(),$(".btn_action").show()}function E(){TIME=0,timeGo=null,SCORE=0,scoreHad=!1,laveTimeGo=null,laveTime=4,x.hide(),w.hide(),u.show(),o.html(0)}function F(){return p.show(),--laveTime<0?(p.hide(),G(),clearInterval(laveTimeGo),void 0):(p.html('<img src="img/num'+laveTime+'.png"/>'),void 0)}function G(){c.width=a,c.height=b,d.Touch.enable(e),d.Ticker.setFPS(60),d.Ticker.addEventListener("tick",e),main=new d.Container,e.addChild(main),I()}function H(){E(),main.removeAllChildren(),clearInterval(laveTimeGo),laveTimeGo=setInterval(F,1e3),F()}function I(){hn=Math.random(),hImg=1,.2>hn&&(hImg=2),photo={w:.6*a,h:.6*a,x:.2*a,y:.3*b,r:12},line={w:.1*a,h:.1*a},h={w:.2*a,h:"",x:.5*a,y:.05*-b},hbg={w:.4*a,x:.5*a,y:.05*-b},h.h=B.getResult("h"+hImg).height*h.w/B.getResult("h"+hImg).width,hbg.h=B.getResult("t4").height*hbg.w/B.getResult("t4").width,hbg.y+=.5*h.h,photoS=new d.Shape,photoS.graphics.s("#fcd901").ss(5).rr(photo.x,photo.y,photo.w,photo.h,photo.r),photobg=new d.Shape,photobg.graphics.f("#fff").rr(photo.x-5,photo.y-5,photo.w+5,photo.h+5,photo.r),photobg.alpha=0,photoShow=new d.Container,photo_1=new d.Shape,photo_1.graphics.s("#fff").ss(10).rr(0,0,photo.w,photo.h,photo.r),photo_1bg=new d.Bitmap(B.getResult("bg1")),photo_1bg.sourceRect={x:photo.x*B.getResult("bg1").width/a,y:photo.y*B.getResult("bg1").height/b,width:photo.w*B.getResult("bg1").width/a,height:photo.h*B.getResult("bg1").height/b},photo_1bg.setTransform(0,0,a/B.getResult("bg1").width,b/B.getResult("bg1").height),photoShow.setTransform(2*photo.x+photo.w/2,2*photo.y+photo.h/2,1,1,0,0,0,photo.x+photo.w/2,photo.y+photo.h/2),lineS=new d.Shape,lineS.graphics.s("#fcd901").ss(5).mt(photo.x+.5*photo.w-.5*line.w,photo.y+.5*photo.h).lt(photo.x+.5*photo.w+.5*line.w,photo.y+.5*photo.h).mt(photo.x+.5*photo.w,photo.y+.5*photo.h-line.h/2).lt(photo.x+.5*photo.w,photo.y+.5*photo.h+line.h/2),hS=new d.Shape,hS.graphics.bf(B.getResult("h"+hImg)).dr(0,0,B.getResult("h"+hImg).width,B.getResult("h"+hImg).height),hS.setTransform(h.x,h.y,h.w/B.getResult("h"+hImg).width,h.h/B.getResult("h"+hImg).height,0,0,0,B.getResult("h"+hImg).width/2,B.getResult("h"+hImg).height/2),hbgS=new d.Shape,hbgS.graphics.bf(B.getResult("t4")).dr(0,0,B.getResult("t4").width,B.getResult("t4").height),hbgS.setTransform(hbg.x,hbg.y,hbg.w/B.getResult("t4").width,hbg.h/B.getResult("t4").height,0,0,0,B.getResult("t4").width/2,B.getResult("t4").height/2),photoShow.addChild(photo_1bg,photo_1),photoShow.alpha=0,main.addChild(photoS,lineS,hS,photoShow,photobg,hbgS),d.Tween.get(hS).wait(300).to({y:b+h.h},1700-200*(2*hn+hImg),d.Ease.circIn).call(J)}function J(){var a,b,c,e,f;return d.Sound.play("btn",{loop:0}),a=hS.clone(!0),a.x=hS.x-photo.x,a.y=hS.y-photo.y,a.mask=photo_1,photoShow.addChild(a),main.removeChild(photoS,lineS,hS,photobg,hbgS),scoreHad?!1:(d.Tween.removeTweens(hS),scoreHad=!0,b=hS.y,c=photo.y,e=photo.y+photo.h,f=photo.y+.35*photo.h,c>b||b>e?SCORE=0:f>=b?SCORE=(b-c)/(f-c)-.003732:b>f&&(SCORE=(e-b)/(e-f)-.003732),0>SCORE&&(SCORE=0),SCORE=Math.abs(100*SCORE*hImg).toFixed(2),window.share.title="我拍到了戴王冠的公主，得了"+SCORE+"分！还有奖品拿喔！",z.html(window.share.title),d.Tween.get(photobg).to({alpha:.5},300).to({alpha:0},200),d.Tween.get(photoShow).wait(100).to({alpha:1}).to({rotation:15},300).call(function(){K()}).to({scaleX:.5,scaleY:.5,x:.5*photo.w,y:1.2*photo.y},300).call(function(){for(var a=0,b=showInfo.length;b>a;a++)if(SCORE<=showInfo[a].score){window.share.desc=showInfo[a].info,$log({title:'<span class="t_geo t_red">'+SCORE+"</span>",conn:showInfo[a].info,btn1:"再拍一次",btn2:"知道了"},function(a){a||H()});break}}),void 0)}function K(){o.html(SCORE),u.hide(),x.show(),w.show()}function L(){var a=navigator.userAgent.toLowerCase();return/iphone/i.test(a)||/ipad/i.test(a)?!0:!1}var M,N,a=$(window).width()>640?640:$(window).width(),b=$(window).height(),c=document.getElementById("canvas"),d=createjs,e=new d.Stage(c),j=($("#xl_loading_p"),$("#xl_loading"),$("#main"),$("#rule")),k=$(".page"),n=($(".page0"),$(".page1"),$(".page2")),o=$("#score"),p=$("#lavetime"),q=$("#btn_action"),r=$("#btn_go"),s=$("#btn_restart"),t=$("#btn_share"),u=$(".btn_goBox"),w=($(".btn_showBox"),$(".showBg")),x=$("#show"),y=$(".progress span"),z=$("title"),A=[{id:"bg",src:"bg.jpg?3"},{id:"t1",src:"t1.png?3"},{id:"bg1",src:"bg1.jpg?3"},{id:"t3",src:"t3.png?3"},{id:"t4",src:"t4.png"},{id:"t5",src:"t5.png"},{id:"num0",src:"num0.png"},{id:"num1",src:"num1.png"},{id:"num2",src:"num2.png"},{id:"num3",src:"num3.png"},{id:"h1",src:"h1.png?3"},{id:"h2",src:"h2.png?3"},{id:"btn_action",src:"btn_action.png?1"},{id:"btn_go",src:"btn_go.png?1"},{id:"btn_restart",src:"btn_restart.png?1"},{id:"btn_share",src:"btn_share.png?1"},{id:"bgm",src:"summer.mp3"},{id:"btn",src:"btn.mp3"}],B=new createjs.LoadQueue(!1,"./img/");B.installPlugin(d.Sound),B.loadManifest(A),B.on("fileload",C),B.on("complete",D),preloadLength=A.length,preloadCurrent=0,L()&&(M=document.getElementById("bgmp3"),N=!1,$(document).on(click,function(){N?M.play():M.paused!==!1&&(M.load(),N=!0,M.play()),$(document).unbind("touchstart")})),q.on(click,function(){k.removeClass("current"),n.addClass("current"),E()}),j.on(click,function(){E(),j.hide(),clearInterval(laveTimeGo),laveTimeGo=setInterval(F,1e3),F()}),r.on(click,J),s.on(click,H),addShare(t)});