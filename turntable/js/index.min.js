var loadImgs=[],loadImage=function(c,e){var b=0;var a=0;for(var d in c){a++}for(var d in c){loadImgs[d]=new Image();loadImgs[d].onload=function(){if(++b>=a){e()}};loadImgs[d].src=c[d]}};window.onload=function(){var a={bg:"img/bg.jpg",title:"img/turn_bg.png",watch:"img/turn_btn.png"};loadImage(a,function(){$("#xl_loading").removeClass("xl_loding_show");load_h();$("#main").show()})};function getJssdk(){$.ajax({url:"../conn/getJssdk.php?rank="+Math.random().toFixed(3),type:check.ajaxType,dataType:check.ajaxDataType,data:{company:"shuian"},success:function(a){wx.config({debug:false,appId:a.appId,timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","hideOptionMenu","showOptionMenu"]});wx.ready(function(){wx.onMenuShareTimeline(window.share);wx.onMenuShareAppMessage(window.share)})}})}getJssdk();$(function(){var b=$(".turn_btn"),v=$(".turn_bg"),k=$("#share"),h=$(".shareover"),s=$("#mygift"),w=$(".mygift"),e=$(".close"),q=$("#myGiftList"),n=$("#rankList"),c=0,m=false,i=0,j=0,f=0,t="",p={0:[{name:"谢谢！继续努力！",center:300}],g0:[{name:"Apple6 plus",center:0}],g1:[{name:"方特门票",center:180}],g2:[{name:"绿博园门票",center:120}],g3:[{name:"精美抽纸",center:240},{name:"精美抽纸",center:60},]},u=["g0","g1","g2","g3"];function g(){$log({title:"快参与活动赢取大奖吧！",con:'<div class="tip">请输入您的真实姓名和手机号！</div><label class="in_ic40"><span class="l"><i class="fa fa-user"></i></span><span class="r"><input type="text" placeholder="请输入姓名" id="name" name="name" maxlength="12"/></span></label><label class="in_ic40"><span class="l"><i class="fa fa-mobile"></i></span><span class="r"><input type="tel" placeholder="请输入手机号码" id="tel" name="tel" maxlength="11"/></span></label>',go:r})}function r(){var y=$("#name").val(),x=$("#tel").val();if(!check.name(y)){return false}if(!check.tel(x)){return false}load();$.ajax({url:check.ajaxUrl+"?rand="+Math.random(),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"reg",name:y,active:active,tel:x,score:0,openid:openid},success:function(z){if(z.errcode==0){$tip("注册成功！");myName=y;myTel=x;$(".myName").html(myName);$(".myTel").html(myTel);reged=1;$("#xl_dialog").remove()}else{$tip(z.errmsg)}load_h()},error:function(){$tip(check.ajaxError)}})}function d(x,z){if(m){return false}if(c==1){return}m=true;c=1;var y="rotate("+(i%360)+"deg)";v.removeAttr("style").attr("style","transform: "+y+"; -webkit-transform: "+y+";");load();$.ajax({url:check.ajaxUrl+"?rand="+Math.random(),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"addDetail",name:myName,active:active,tel:myTel,openid:openid,giftProbability:giftProbability},success:function(B){setTimeout(function(){c=0},1000);console.log(B);if(B.errcode==0){f=B.gift;x=x||10;z=z||5;t=p[f][Math.floor(Math.random()*p[f].length)];a();m=true;i=360*x+t.center;var A="rotate("+i+"deg)",C="all ease "+z+"s";v.attr("style","transform: "+A+"; -webkit-transform: "+A+"; transition: "+C+"; -webkit-transition: "+C+";");setTimeout(function(){m=false;l(t,B.gift)},z*1000)}else{m=false;$tip(B.errmsg)}load_h()},error:function(){$tip(check.ajaxError);c=0}})}function l(z,y){var x;if(y==0){x="很遗憾，这次没有中奖，继续努力吧！"}else{x="恭喜您，获得：<span class='t_green'>"+z.name+" </span>"}$log({btn1:"我的奖品",con:'<div class="t_lh2r t_c"><p>'+x+"</p></div>"},function(A){if(!A){s.trigger(click)}})}function o(){if(reged==1){d()}else{g()}}function a(){if(f!=0){var x,y=w.find("li").length;if(y>0){if(w.find(".noGift").length<1){x='<li><span class="gift_name">奖品'+(y+1)+"："+t.name+'</span><span class="gift_btn gift_btn_show">兑换</span></li>';q.append(x)}else{x='<li><span class="gift_name">奖品'+1+"："+t.name+'</span><span class="gift_btn gift_btn_show">兑换</span></li>';q.html(x)}}}}s.on(click,function(){if(m){return false}if(reged==1){getAppleTimes=1;if(j==0){if(c==1){return}c=1;load();$.ajax({url:check.ajaxUrl+"?rand="+Math.random(),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"queryDetailList",active:active,openid:openid},success:function(D){c=0;if(D.errcode==0){j=1;var C=D.list,B=C.length,A="",z="",x=0,E=0;if(B>0){for(var y=0;y<B;y++){if(C[y].gift!=0){E++;x=1;if(C[y].exchange==1){z='<span class="gift_btn no">已兑换</span>'}else{z='<span class="gift_btn gift_btn_show">兑换</span>'}A+='<li data-id="'+C[y].oid+'">奖品'+(E)+'：<span class="gift_name">'+p[C[y].gift][0]["name"]+"</span>"+z+"</li>"}}if(x==0){A+='<li class="t_c noGift">您还没有中奖呢！继续努力吧！</li>'}}else{A+='<li class="t_c noGift">您还没有中奖呢！继续努力吧！</li>'}q.html(A);w.show(300)}load_h()},error:function(){$tip(check.ajaxError);c=0}});$.ajax({url:check.ajaxUrl+"?rand="+Math.random(),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"getActiveUserGiftList",active:active},success:function(B){c=0;console.log(B);if(B.errcode==0){var A=B.list,z=A.length,y="",C=0;if(z>0){for(var x=0;x<z;x++){C++;y+='<li><span class="rank_num">'+(C)+'</span><span class="rank_name">'+A[x].name+'</span><span class="gift_name">'+p[A[x].gift][0]["name"]+"</span></li>"}}n.html(y)}load_h()},error:function(){$tip(check.ajaxError)}})}else{w.show(300)}window.scrollTo(0,0)}else{g()}});$(".gift_box_con").on(click,".gift_btn_show",function(){var y=$(this),x=y.parent().data("id");if(y.hasClass("no")){return false}$log({title:"请输入兑换密码！",con:'<label class="in_ic40"><span class="l"><i class="fa fa-lock"></i></span><span class="r"><input type="text" placeholder="请输入兑换密码" id="pwd" name="pwd"/></span></label>',go:function(){var z=$("#pwd").val();if(check.empty(z,"请输入兑奖密码！")){return}if(c==1){return}c=1;load();$.ajax({url:check.ajaxUrl+"?rand="+Math.random(),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"giftExchange",oid:x,active:active,pwd:z},success:function(A){c=0;if(A.errcode==0){$tip(A.errmsg);y.html("已兑换").addClass("no").removeClass("gift_btn_show");$("#xl_dialog").remove()}else{$tip(A.errmsg)}load_h()},error:function(){c=0;load_h();$tip(check.ajaxError)}})}})});b.on(click,o);k.on(click,function(){h.show(300)});h.on(click,function(){h.hide(300)});e.on(click,function(){w.hide(300)})});