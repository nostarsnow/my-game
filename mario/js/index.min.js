function loaded(){$xl_loading_p.html("100%"),$main.css("display","block"),$xl_loading.removeClass("xl_loding_show"),ns.loadHide(),reset(),$(".choose_man .lr_1").on(click,function(){$(".choose_man .lr_1").removeClass("current"),$(this).addClass("current")}),$(".choose_dif li").on(click,function(){$(".choose_dif li").removeClass("current"),$(this).addClass("current")}),$(".btn_go").on(click,function(){if($(".choose_man .current").length<1)return void ns.tip("请选择一个人物！");if($(".choose_dif .current").length<1)return void ns.tip("请选择一个难度！");switch(manSelect=$(".choose_man .current").data("id"),$(".choose_dif .current").data("id")){case 0:monsterCol=1,monsterRow=2.5*monsterHeight,leftRightSpeed=3e3,fallSpeed=6e3,minLeftRightSpeed=1e3,minFallSpeed=2500;break;case 1:monsterCol=1,monsterRow=2*monsterHeight,leftRightSpeed=2e3,fallSpeed=5e3,minLeftRightSpeed=900,minFallSpeed=2500;break;case 2:monsterCol=1,monsterRow=1.5*monsterHeight,leftRightSpeed=1500,fallSpeed=4e3,minLeftRightSpeed=800,minFallSpeed=1300;break;case 3:monsterCol=2,monsterRow=1.5*monsterHeight,leftRightSpeed=1e3,fallSpeed=2500,minLeftRightSpeed=700,minFallSpeed=1300}$(".choose").hide(),init()})}function reset(t){stage.clear(),main=new cj.Container,stage.addChild(main),HIT=7,hited=!0,$hit=$("#hit"),$score=$("#score"),$time=$("#time"),S_LEFT=.05*W,S_RIGHT=.95*W,BUGTIME=2e3,TIME=0,SCORE=0,monsterWidth=.07*W,monsterHeight=.07*W,monsterRow=2*monsterHeight,monsterCol=1,leftRightSpeed=2e3,fallSpeed=4e3,minLeftRightSpeed=700,minFallSpeed=2e3,manSelect=0,monster=[],coin=[],PAUSE=!1,$hit.html(7),$score.html(0),$time.html(0),t&&init()}function init(){bulidInit(),page1(),createjs.Ticker.setFPS(30),cj.Ticker.addEventListener("tick",update),timeGo=setInterval(function(){$time.html(++TIME)},1e3)}function update(){stage.update();for(var t=0;t<monster.length;t++){if(coin.length&&coin[t]&&coin[t].parent&&t<coin.length&&coin[t].noGet){var e=Math.abs(man.x-coin[t].x),o=Math.abs(man.y-coin[t].y-coin[t].parent.y);e<man.opts.hw+coin[t].opts.hw&&o<man.opts.hh+coin[t].opts.hh&&(coin[t].noGet=!1,cj.Tween.removeTweens(coin[t]),cj.Tween.get(coin[t]).to({x:S_LEFT,y:-coin[t].parent.y,alpha:0},500,cj.Ease.backIn),$score.html(SCORE+=coin[t].opts.score))}var e=Math.abs(man.x-monster[t].x),o=Math.abs(man.y-monster[t].y-monster[t].parent.y);if(e<man.opts.hw+monster[t].opts.hw&&o<man.opts.hh+monster[t].opts.hh){if(hited)return!1;if(0==HIT)return cj.Tween.removeAllTweens(),man.removeAllEventListeners(),road.removeAllEventListeners(),clearInterval(timeGo),void setTimeout(function(){ns.log({title:"游戏成绩",con:'<div class="t_c"><p>获得金币：<span class="t_green">'+SCORE+'</span>个</p><p>坚持时间：<span class="t_green">'+TIME+"</span>个</p></div>",btn_cancel:"取消",btn_confirm:"再次挑战",confirm:function(){location.href="index.html"}})},500);if(HIT<0)return;bug(),hited=!0,$hit.html(--HIT)}}}function page1(){man_set=[{bw:16,bh:29,w:.07*W,x:.4*W,y:.9*H,regX:0,regY:0,src:loader.man},{bw:16,bh:29,w:.07*W,x:.4*W,y:.9*H,regX:0,regY:29,src:loader.man}],man=new man_bulid(man_set[manSelect]),monster_set=[{bw:16,bh:16,w:.07*W,src:loader.monster,regX:0,regY:0},{bw:16,bh:16,w:.07*W,src:loader.monster,regX:0,regY:16},{bw:16,bh:16,w:.07*W,src:loader.monster,regX:0,regY:32}],coin_set=[{bw:12,bh:16,w:.06*W,src:loader.coin,regX:0,regY:0,frames:[0,1,2,3],speed:.5,score:1},{bw:15,bh:16,w:.06*W,src:loader.coin,regX:0,regY:16,frames:[0],speed:1,score:2},{bw:16,bh:16,w:.06*W,src:loader.coin,regX:0,regY:32,frames:[0],speed:1,score:5}],monsterContainer1=new cj.Container,road=new cj.Shape,road.graphics.bf(loader.road,"repeat").dr(0,0,loader.road.width,loader.road.height),road.setTransform(0,-H,W/loader.road.width,2*H/loader.road.height),monsterContainer2=monsterContainer1.clone(),main.addChild(road,monsterContainer1,monsterContainer2,man),man.on("pressmove",function(t){t.stageX<man.opts.hw+S_LEFT?man.x=man.opts.hw+S_LEFT:t.stageX>S_RIGHT-man.opts.hw?man.x=S_RIGHT-man.opts.hw:man.x=t.stageX,t.stageY>man.opts.y?man.y=man.opts.y:t.stageY<man.opts.hh+40?man.y=man.opts.hh+40:man.y=t.stageY}),road.on("pressmove",function(t){t.stageX<man.opts.hw+S_LEFT?man.x=man.opts.hw+S_LEFT:t.stageX>S_RIGHT-man.opts.hw?man.x=S_RIGHT-man.opts.hw:man.x=t.stageX}),max_left=S_LEFT+.5*monsterWidth,max_right=S_RIGHT-.5*monsterWidth,buildMonster("monsterContainer1",!1),buildMonster("monsterContainer2",!0),bug(),cj.Tween.get(road).to({y:-H}).to({y:0},fallSpeed).loop=!0}function buildMonster(t,e){leftRightSpeed>minLeftRightSpeed&&(leftRightSpeed-=50),fallSpeed>minFallSpeed&&(fallSpeed-=100),H_monsterLength=parseInt((.9*H-.1*W)/monsterRow)+1;var o=0;("monsterContainer2"==t||e)&&(o=-H),window[t].removeAllChildren(),window[t].y=o;for(var s=0;s<H_monsterLength;s++)for(var n=0;n<monsterCol;n++){monster_s=new monster_bulid,y=monsterRow*s+monster_s.opts.hw,monster_s.opts.y=y,monster_s.opts.roadR=max_right-S_LEFT,monster_s.y=y;var r=monsterCol*s+n,i=Math.random();monster_s.opts.speed=monster_s.opts.speed*(i+1),W*i<=max_left?i=max_left:W*i>=max_right?i=max_right:i*=W,monster_s.x=i,monster_s.opts.x=i,monster_s.opts.roadX=i-S_LEFT,"monsterContainer2"==t&&(r=H_monsterLength+monsterCol*s+n);var a=Math.floor(20*Math.random());if(a>1){var h=new coin_bulid(a);h.x=i,h.y=y,coin[r]=h,window[t].addChild(coin[r]),a>18&&(cj.Tween.get(coin[r]).to({x:max_right},500*(1-monster_s.opts.roadX/monster_s.opts.roadR)).to({x:i},500*(1-monster_s.opts.roadX/monster_s.opts.roadR)).to({x:max_left},500*monster_s.opts.roadX/monster_s.opts.roadR).to({x:i},500*monster_s.opts.roadX/monster_s.opts.roadR).loop=!0)}monster[r]=monster_s,window[t].addChild(monster[r]),i>.5*W?cj.Tween.get(monster[r]).to({x:max_right},monster_s.opts.speed*(1-monster_s.opts.roadX/monster_s.opts.roadR)).to({x:i},monster_s.opts.speed*(1-monster_s.opts.roadX/monster_s.opts.roadR)).to({x:max_left},monster_s.opts.speed*monster_s.opts.roadX/monster_s.opts.roadR).to({x:i},monster_s.opts.speed*monster_s.opts.roadX/monster_s.opts.roadR).loop=!0:cj.Tween.get(monster[r]).to({x:max_left},monster_s.opts.speed*monster_s.opts.roadX/monster_s.opts.roadR).to({x:i},monster_s.opts.speed*monster_s.opts.roadX/monster_s.opts.roadR).to({x:max_right},monster_s.opts.speed*(1-monster_s.opts.roadX/monster_s.opts.roadR)).to({x:i},monster_s.opts.speed*(1-monster_s.opts.roadX/monster_s.opts.roadR)).loop=!0}e?cj.Tween.get(window[t]).to({y:H},2*fallSpeed).call(function(){buildMonster(t,!0)}):cj.Tween.get(window[t]).to({y:H},fallSpeed).call(function(){buildMonster(t,!0)})}function bulidInit(){man_bulid=function(t){return this.opts=t,this.opts.h=this.opts.bh*this.opts.w/this.opts.bw,this.opts.hw=.5*this.opts.w,this.opts.hh=.5*this.opts.h,this.create()},man_bulid.prototype={create:function(){var t=new cj.SpriteSheet({images:[this.opts.src],frames:[[this.opts.regX,this.opts.regY,this.opts.bw,this.opts.bh],[this.opts.regX+this.opts.bw,this.opts.regY,this.opts.bw,this.opts.bh]],animations:{go:{frames:[0,1],next:"go",speed:.3}}}),e=new cj.Sprite(t,"go");return e.setTransform(this.opts.x,this.opts.y,this.opts.w/this.opts.bw,this.opts.h/this.opts.bh,0,0,0,.5*this.opts.bw,.5*this.opts.bh).framerate=30,e.opts=this.opts,e}},road_bulid=function(t){return this.opts=t,this.create()},road_bulid.prototype={create:function(){var t=new cj.Shape;return t.graphics.f(this.opts.color).r(this.opts.x,this.opts.y,this.opts.w,this.opts.h),t.opts=this.opts,t}},monster_bulid=function(t){var e=Math.floor(Math.random()*monster_set.length);this.opts={};for(var o in monster_set[e])this.opts[o]=monster_set[e][o];return this.opts.speed=leftRightSpeed,this.opts.h=this.opts.bh*this.opts.w/this.opts.bw,this.opts=$.extend(this.opts,t),this.opts.hw=.5*this.opts.w,this.opts.hh=.5*this.opts.h,this.create()},monster_bulid.prototype={create:function(){var t=new cj.SpriteSheet({images:[this.opts.src],frames:[[this.opts.regX,this.opts.regY,this.opts.bw,this.opts.bh],[this.opts.regX+this.opts.bw,this.opts.regY,this.opts.bw,this.opts.bh]],animations:{go:{frames:[0,1],next:"go",speed:.3}}}),e=new cj.Sprite(t,"go");return e.setTransform(0,0,this.opts.w/this.opts.bw,this.opts.h/this.opts.bh).framerate=30,e.regX=.5*this.opts.bw,e.regY=.5*this.opts.bh,e.opts=this.opts,e}},coin_bulid=function(t){t=t<=16?0:t<=18?1:2,this.opts={};for(var e in coin_set[t])this.opts[e]=coin_set[t][e];this.opts.h=this.opts.bh*this.opts.w/this.opts.bw,this.opts.hw=.5*this.opts.w,this.opts.hh=.5*this.opts.h;var o=this.opts.frames.length;this.opts.framesCut=[];for(var e=0;e<o;e++)this.opts.framesCut[e]=[this.opts.regX+this.opts.bw*e,this.opts.regY,this.opts.bw,this.opts.bh];return this.create()},coin_bulid.prototype={create:function(){var t=new cj.SpriteSheet({images:[this.opts.src],frames:this.opts.framesCut,animations:{go:{frames:this.opts.frames,next:"go",speed:this.opts.speed}}}),e=new cj.Sprite(t,"go");return e.setTransform(0,0,this.opts.w/this.opts.bw,this.opts.h/this.opts.bh).framerate=30,e.regX=.5*this.opts.bw,e.regY=.5*this.opts.bh,e.opts=this.opts,e.noGet=!0,e}}}function bug(){cj.Tween.get(man).to({alpha:.2},BUGTIME/5).to({alpha:.4},BUGTIME/5).to({alpha:.6},BUGTIME/5).to({alpha:.8},BUGTIME/5).to({alpha:1},BUGTIME/5).call(function(){hited=!1})}var canvas=document.getElementById("canvas"),W=window.innerWidth>640?640:window.innerWidth,H=window.innerHeight;canvas.width=W,canvas.height=H;var cj=createjs,stage=new cj.Stage(canvas);cj.Touch.enable(stage),ns.load();var loader=[],$xl_loading_p=$("#xl_loading_p"),$xl_loading=$("#xl_loading"),$main=$("#main"),loadImage=function(t,e){var o=0,s=0;for(var n in t)s++;for(var n in t)/.mp3/.test(t[n])?(loader[n]=new Audio(t[n]),loader[n].load(),++o>=s&&e()):(loader[n]=new Image,loader[n].onload=function(){$xl_loading_p.html((o/s*100).toFixed(2)+"%"),++o>=s&&e()},loader[n].src=t[n])};window.onload=function(){loadImage({man:"img/man.png",coin:"img/coin.png",monster:"img/monster.png",road:"img/road.jpg"},loaded)};