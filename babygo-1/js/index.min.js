!function(){function G(){F.html((100*c.progress).toFixed(2)+"%").width((100*c.progress).toFixed(2)+"%")}function H(){F.parent().hide(),$(".btn_action").show(),J()}function I(){a.Tween.get(roadLr).to({y:0}).to({y:f},roadSpeed).call(function(){roadSpeed>fallSpeed&&(roadSpeed=fallSpeed),I()})}function J(){a.Touch.enable(g),g.clear(),main=new a.Container,g.addChild(main),TIME=0,timeGo=null,fallSpeed=5e3,roadSpeed=fallSpeed,waitTime=1500,COINS=[],Man_now=0,SCORE=0,TIME=0,lastDeviceGet=0,ACTION=!1}function K(){L(),clearInterval(timeGo),a.Ticker.setFPS(60),a.Ticker.addEventListener("tick",O),timeGo=setInterval(function(){TIME++},1e3)}function L(){e=c.getResult("roadLr").width*f/c.getResult("roadLr").height,d.width=e,d.height=f,roadLr=new a.Shape,roadLr.graphics.bf(c.getResult("roadLr"),"repeat-y",new a.Matrix2D(e/c.getResult("road").width,0,0,f/c.getResult("road").height,0,0)).dr(0,-f,e,2*f),road=new a.Bitmap(c.getResult("road")),road.setTransform(0,0,e/c.getResult("road").width,f/c.getResult("road").height),man_set={bw:125,bh:92,regX:0,regY:0,w:.18*e,x:.5*e,y:.87*f,count:10,speed:.07},man_set.h=man_set.bh*man_set.w/man_set.bw,man_set.hw=.5*man_set.w,man_set.hh=.5*man_set.h,man_set.bottom=man_set.y+man_set.hh,man_set.top=man_set.y-man_set.hh,coin_set={bw:130,bh:115,regX:0,regY:0,w:.13*e,h:.115*e,countC:5,probability:.3},coin_set.hw=.5*coin_set.w,coin_set.hh=.5*coin_set.h,coin_set.rowH=3.5*coin_set.h,coin_set.col=parseInt(f/coin_set.rowH)+1,S_LEFT=.15*e,S_RIGHT=.85*e,man_anim=new a.SpriteSheet({images:[c.getResult("man")],frames:{width:man_set.bw,height:man_set.bh,count:man_set.count,regX:man_set.regX,regY:man_set.regY},animations:{man0:{frames:[0],next:null}}}),man=new a.Sprite(man_anim,"man"+Man_now),man.setTransform(man_set.x,man_set.y,man_set.w/man_set.bw,man_set.h/man_set.bh,0,0,0,.5*man_set.bw,.5*man_set.bh).framerate=30,man.maxL=S_LEFT+man_set.hw,man.maxR=S_RIGHT-man_set.hw,man.trs=.5*e/90,coinsContainer=new a.Container,scoreBg=new a.Shape,scoreBg.graphics.f("#24981d").s("#fff").rr(.17*e,10,.66*e,.1*f,7),scoreShow=new a.Text("0 m","1rem georgiab","#fff"),scoreShow.x=.5*e,scoreShow.y=10+.05*f,scoreShow.textAlign="center",scoreShow.textBaseline="middle",main.addChild(roadLr,road,coinsContainer,scoreBg,scoreShow,man),window.DeviceMotionEvent?window.addEventListener("devicemotion",P,!1):$tip("亲，你的浏览器不支持重力感应哟~")}function M(b){var d,g,h;SCORE>8e3?(fallSpeed=1500,waitTime=350):SCORE>6e3?(fallSpeed=2e3,waitTime=450):SCORE>5e3?(fallSpeed=2500,waitTime=600):SCORE>4e3?(fallSpeed=3e3,waitTime=700):SCORE>3e3?(fallSpeed=3500,waitTime=800):SCORE>2e3?(fallSpeed=4e3,waitTime=1e3):SCORE>1e3&&(fallSpeed=4500,waitTime=1200),COINS.length>15&&(COINS=COINS.splice(5,COINS.length)),d=N(Man_now),g=e*Math.random(),h=-coin_set.h,S_LEFT>g?g=S_LEFT:g>S_RIGHT-coin_set.w&&(g=S_RIGHT-coin_set.w),d.x=g,d.y=h,COINS.push(d),coinsContainer.addChild(d),a.Tween.get(d).to({y:f},fallSpeed),setTimeout(function(){M(b,!0)},waitTime)}function N(b){var d=Math.floor(Math.random()*coin_set.countC),e=new a.SpriteSheet({images:[c.getResult("coin")],frames:[[coin_set.bw*d,coin_set.bh*b,coin_set.bw,coin_set.bh]],animations:{go:{frames:[0],next:null}}}),f=new a.Sprite(e,"go");return f.setTransform(0,0,coin_set.w/coin_set.bw,coin_set.h/coin_set.bh).framerate=30,f}function O(){g.update(),ACTION&&(scoreShow.text=++SCORE+" m");for(var b=0,c=COINS.length;c>b;b++)if(COINS[b]&&!COINS[b].geted){if(!COINS[b].geted&&COINS[b].y-man_set.bottom>0)return Q(),void 0;collCheck.rect(COINS[b],man)&&(COINS[b].geted=!0,a.Tween.removeTweens(COINS[b]),a.Tween.get(COINS[b]).to({x:.5*e,y:-coin_set.h,alpha:0},500,a.Ease.backIn))}}function P(b){var d,e,f,c=(new Date).getTime();c-lastDeviceGet>30&&(lastDeviceGet=c,d=b.accelerationIncludingGravity,e=Math.round(-90*(d.x/9.81)),h&&(e=-1*e),f=man_set.x+e*man.trs,f<man.maxL&&(f=man.maxL),f>man.maxR&&(f=man.maxR),a.Tween.removeTweens(man),a.Tween.get(man).to({x:f},100,a.Ease.linear))}function Q(){SCORE>myBestScore?(S(),numberTo(w,SCORE,37)):w.html(myBestScore),a.Ticker.removeAllEventListeners(),clearInterval(timeGo),q.removeClass("current"),t.addClass("current"),window.share.desc="我的火炬手在商丘恒大名都“全民乐跑 礼享名都”活动中用"+TIME+"秒前进了"+SCORE+"米！不服？来战！",numberTo(v,SCORE,37)}function R(){$.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl_r="+Math.random().toFixed(3),data:{action:"queryInfo",active:active,openid:openid},dataType:check.ajaxDataType,success:function(a){console.log(a),0==a.errcode?(D.html(a.rank),E.html(a.score)):$tip(a.errmsg)},error:function(){$tip(check.ajaxError)}})}function S(){enKey&&enIv&&(load(),$.ajax({url:check.ajaxUrl+"?xl_r="+Math.random().toFixed(3),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"addDetail",active:active,openid:openid,score:SnowCryEncrypt(SCORE,enKey,enIv),time:SnowCryEncrypt(TIME,enKey,enIv)},success:function(a){console.log(a),0==a.errcode&&(R(),$tip("更新成功！")),load_h()},error:function(){$tip(check.ajaxError),ajaxLock=0}}))}function T(){load(),$.ajax({url:check.ajaxUrl+"?xl_r="+Math.random().toFixed(3),type:"POST",dataType:"json",data:{action:"queryList",pageIndex:i,pageSize:j,active:active},success:function(a){var b,c,d,e;if(load_h(),console.log(a),0==a.errcode)if(ajaxLock=!1,b=a.list,c=b.length,d="",c>0){for(i++,e=0;c>e;e++)k++,d+='<li><span class="rank_num">'+k+'</span><span class="rank_name">'+b[e].name+'</span><span class="rank_score">'+(b[e].score||0)+"</span></li>";C.append(d)}else l=!0}})}function U(){load(),$.ajax({url:check.ajaxUrl+"?xl_r="+Math.random().toFixed(3),type:check.ajaxType,data:{action:"checkTimes",active:active,openid:openid},dataType:check.ajaxDataType,success:function(a){console.log(a),0==a.errcode?(q.removeClass("current"),s.addClass("current"),K(),man.y=.2*f):$tip(a.errmsg),load_h()},error:function(){load_h(),$tip(check.ajaxError)}})}var d,e,f,g,h,i,j,k,l,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,V,W,a=createjs,b=[{id:"bg",src:"bg.jpg"},{id:"t1",src:"t1.png"},{id:"btn_rule",src:"btn_rule.png"},{id:"btn_rank",src:"btn_rank.png"},{id:"btn_go",src:"btn_go.png"},{id:"rank",src:"rank.jpg"},{id:"btn_action",src:"btn_action.png"},{id:"road",src:"road.png"},{id:"roadLr",src:"roadLr.png"},{id:"man",src:"human.png"},{id:"coin",src:"coin.png"}],c=new a.LoadQueue(!1,"./img/");c.loadManifest(b),c.on("fileload",G),c.on("complete",H),d=document.getElementById("canvas"),e=$(window).width()>320?320:$(window).width(),f=$(window).height(),g=new a.Stage(d),h=navigator.userAgent.match(/iP(ad|hone|od)/i),i=1,j=50,k=0,l=!1,$("#xl_loading_p"),$("#xl_loading"),$("#main"),p=$("#btn_go"),q=$(".page"),r=$(".page1"),s=$(".page2"),t=$(".page3"),u=$(".page4"),v=$("#distance"),w=$("#time"),x=$("#btn_action"),y=$(".phone"),z=$(".btn_rank"),A=$("#btn_restart"),B=$("#rank"),C=B.find("ul"),D=$("#myRank"),E=$("#myScore"),F=$(".progress span"),load(),p.on(click,function(){return 1==reged?(U(),void 0):($log({title:"让你的朋友知道你吧！",conn:'<div class="tip">请输入您的昵称！</div><label class="in_ic40"><span class="l"><i class="fa fa-user"></i></span><span class="r"><input type="text" placeholder="请输入昵称" id="name" name="name" maxlength="12"/></span></label>',go:function(){var a=$("#name").val(),b="";return check.name(a)?(load(),$.ajax({url:check.ajaxUrl+"?xl_r="+Math.random().toFixed(3),type:check.ajaxType,data:{action:"reg",name:a,active:active,tel:b,openid:openid},dataType:check.ajaxDataType,success:function(c){0==c.errcode?(myName=a,myTel=b,reged=1,$tip("注册成功！"),location.href="index.php"):$tip(c.errmsg),load_h()},error:function(){load_h(),$tip(check.ajaxError)}}),void 0):!1}}),void 0)}),x.on(click,function(){y.hide(),man.y=man_set.y,y.hide(),man.y=man_set.y,SCORE=0,ACTION=!0,setTimeout(function(){M("coins1")},1e3),I()}),z.on(click,function(){q.removeClass("current"),u.addClass("current"),C.empty(),i=1,l=!1,k=0,T()}),A.on(click,function(){SCORE>0||TIME>0?location.href="index.php":(q.removeClass("current"),r.addClass("current"))}),B.scroll(function(){!l&&!ajaxLock&&C.height()-B.height()-B.scrollTop()<20&&(ajaxLock=!0,T())}),V=document.getElementById("bgmp3"),W=!1,$(document).on("touchstart",function(){W?V.play():V.paused!==!1&&(V.load(),W=!0,V.play()),$(document).unbind("touchstart")})}();