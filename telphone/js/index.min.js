$(function(){function s(){$progress.html((100*preload.progress).toFixed(2)+"%")}function u(){var a=new Date,b=a.getMonth()+1,c=a.getDate(),d=a.getHours(),e=a.getMinutes();return{month:b>9?b:"0"+b,day:c>9?c:"0"+c,hour:d>9?d:"0"+d,min:e>9?e:"0"+e,week:a.getDay()}}function v(){var a=u();0==h.begin&&(h.begin=a),l++,n>=o&&0==l%p&&($powernum.html(n+"%"),$powerProgress.width(n+"%"),n--),h.min!=a.min&&(h.min=a.min,$time.html(a.hour+":"+a.min)),h.day!=a.day&&(h.day=a.day,$date.html(a.month+"月"+a.day+"日 星期"+"日一二三四五六"[a.week]))}function w(){$drag.on("touchstart",function(a){return this.moving?!1:($(this).hasClass("message")&&$(this).addClass("movedown"),this.moving=!0,this.bx=a.touches[0].pageX,void 0)}),$drag.on("touchmove",function(a){if(!this.moving)return!1;var b=a.touches[0].pageX,c=b-this.bx;return c>j?(this.moving=!1,C(),!1):(c>0&&$(this).css("left",c),void 0)}),$drag.on("touchend",function(){this.moving=!1,$(this).removeClass("movedown").animate({left:0},300)})}function x(){var d,e,i,j,f,g,a=c.slice(2),b=[];for(d=0,e=a.length;e>d;d++)b.push(a.splice(Math.floor(Math.random()*a.length),1)[0]);for(d=0,e=b.length,f=[],g=new Date;e>d;d++)g.setMinutes(h.begin.min-~~(17*d*Math.random()+11)),g.setHours(h.begin.hour-1.5*d),i=g.getHours(),10>i&&(i="0"+i),j=g.getMinutes(),10>j&&(j="0"+j),f.push('<li><a href="javascript:;"><div class="headimg"><img src="img/h'+b[d].img+'.jpg"/>'+"</div>"+'<div class="mesbox">'+'<p class="nickname">'+b[d].name+"</p>"+'<p class="message">'+b[d].msg+"</p>"+"</div>"+'<div class="mestime">'+i+":"+j+"</div>"+"</a>"+"</li>");$wx_mes.append(f.join(""))}function y(a,b,c){$page.page.removeClass("current"),$(".list").removeClass(function(a,b){return(b.match(/list(-.*)?/g)||[]).join(" ")}).removeClass("current"),a&&$page["page"+a].addClass("current list list--1"),b&&$page["page"+b].addClass("current list list-0"),c&&$page["page"+c].addClass("current list list-1")}function z(a){var b=$(".list--1"),c=$(".list-0"),d=$(".list-1");a?(d.removeClass("current list--1"),c.removeClass("list-0").addClass("list-1"),b.removeClass("list--1").addClass("list-0")):(b.removeClass("current list--1"),c.removeClass("list-0").addClass("list--1"),d.removeClass("list-1").addClass("list-0"))}function A(a,b){var d,j,e=a.type,f=a.headimg,g=a.msg,h="",i=a.link;return"time"==e?(d='<li class="mes_time"><span>',g?d+=g:(j=u(),d+=j.hour+":"+j.min),d+="</span></li>"):(b&&(h='<div class="nickname">'+c[f+1].name+"</div>"),d='<li class="mes_'+e+'">'+(a.link?'<a href="'+i+'" class="wx_link">':'<a href="javascript:;">')+'<div class="headimg">'+'<img src="img/h'+f+'.jpg"/>'+"</div>"+h+'<div class="mesbox">'+g+"</div>"+"</a>"+"</li>"),d}function B(){r[1]=1,$page.page.removeClass("current"),$page.page1.addClass("current"),w(),$signal.each(function(a,b){!function(a){setTimeout(function(){$(b).addClass("full")},300*a)}(a)}),navigator.userAgent.match(/wifi/i)?$nettype.addClass("wifi"):$nettype.addClass("cmnet")}function C(a){if(ajaxLock=!1,a?y.apply(this,i[5]):y.apply(this,i[0]),1==r[2])return ajaxLock=!1,!1;r[2]=1;var b=$(".page2 .wxheader"),c=$(".page2 .wxbody"),d=$(".page2 .wxfooter"),e=c.find(".daddy"),f=e.find(".hand");c.height(g-$header.height()-b.height()-d.height()),e.find(".mestime").html(h.begin.hour+":"+h.begin.min),f.show(),x(),e.on(click,function(){return ajaxLock?!1:(f.hide(),y.apply(this,i[0]),$(".page2 .daddy .newmes").hide(),ajaxLock=!0,z(),setTimeout(function(){D()},q),void 0)}),$wx_mes.on(click,".group",function(){return ajaxLock?!1:(y.apply(this,i[5]),ajaxLock=!0,z(),setTimeout(function(){G()},q),void 0)})}function D(){function B(){setTimeout(function(){v[w]=A(d[w]),a.append(v[w]),u.html(d[w].msg),h[0].scrollTop=g,w++,(2==w||4==w)&&m.show(),x>w&&"right"!=d[w].type&&B()},d[w].time)}if(y.apply(this,i[1]),1==r[3])return ajaxLock=!1,!1;r[3]=1;var a=$(".page3 .wx_mes ul"),b=$(".page3 .wxheader"),c=b.find(".goback"),e=b.find(".right"),f=b.find(".hand"),h=$(".page3 .wxbody"),j=$(".page3 .wxfooter"),k=j.find(".mes"),l=j.find(".messmall"),m=l.find(".hand"),n=j.find(".mesbig"),o=j.find(".mesinput"),p=j.find(".mesbtn"),s=p.find(".hand"),t=$(".page3 .hand"),u=$(".page2 .daddy .message"),v=[],w=0,x=d.length;h.height(g-$header.height()-b.height()-j.height()),B(),c.on(click,function(){t.hide(),z(!0),C()}),l.on(click,function(){return w>=x?!1:"right"!=d[w].type?!1:(k.removeClass("current"),n.addClass("current"),s.show(),o.html(d[w].msg).css("line-height",o.height()+"px"),void 0)}),p.on("click",function(){return"right"!=d[w].type?!1:(t.hide(),v[w]=A(d[w]),a.append(v[w]),u.html(d[w].msg),h[0].scrollTop=g,k.removeClass("current"),l.addClass("current"),o.empty(),w++,w>x?!1:w==x?(f.show(),ajaxLock=!1,void 0):(B(),void 0))}),e.on(click,function(){return ajaxLock?($tip("先和爸爸说几句话吧！"),!1):(t.hide(),ajaxLock=!0,z(),setTimeout(function(){E()},q),void 0)})}function E(){if(y.apply(this,i[2]),ajaxLock=!1,1==r[4])return ajaxLock=!1,!1;var a=$(".page4 .wxheader .goback"),b=$("#adduser"),c=$(".adduser .hand");r[4]=1,c.show(),a.on(click,function(){c.hide(),z(!0),D()}),b.on(click,function(){return ajaxLock?!1:(c.hide(),ajaxLock=!0,z(),setTimeout(function(){F()},q),void 0)})}function F(){var a,b,d,e,f,h,j,k,l,m,n,o,p,q,t;if(y.apply(this,i[3]),1==r[5])return ajaxLock=!1,!1;for(r[5]=1,a=$(".page5 .wxheader"),b=$(".page5 .wxbody"),d=a.find(".goback"),e=$(".page5 .wxfooter"),f=$(".wx_userselected"),h=$(".page5 .wx_userlist ul"),j=a.find(".right"),k=a.find(".hand"),b.height(g-$header.height()-a.height()-e.height()),l=c.slice(2),m=[],n=0,o=l.length;o>n;n++)m.push(l.splice(Math.floor(Math.random()*l.length),1)[0]);for(n=0,o=m.length,p=[];o>n;n++)q=0==n?'<div class="hand up"><i class="fa fa-hand-o-up"></i></div>':"",p.push('<li><a href="javascript:;"><div class="selector"><i class="fa fa-circle-o"></i>'+q+"</div>"+'<div class="headimg">'+'<img src="img/h'+m[n].img+'.jpg"/>'+"</div>"+'<div class="nickname">'+m[n].name+"</div>"+"</a>"+"</li>");h.append(p.join("")),h.find(".hand").show(),t=$(".page5 .hand"),h.on(click,"li",function(){var b,a=$(this);p=[],t.hide(),a.toggleClass("selected"),b=h.find(".selected"),b.each(function(a,b){p[a]='<li><a href="javascript:;"><div class="headimg"><img src="'+$(b).find(".headimg img").attr("src")+'"/>'+"</div>"+"</a>"+"</li>"}),b.length==o?(k.show(),ajaxLock=!1,j.html("确定 ("+o+")").addClass("canClick")):(ajaxLock=!0,j.html("确定 ("+b.length+")").removeClass("canClick")),f.html(p.join(""))}),d.on(click,function(){t.hide(),z(!0),E()}),j.on(click,function(){return ajaxLock||h.find(".selected").length!=o?($tip("要把所有家人都选择进来哟！"),!1):(t.hide(),ajaxLock=!0,G(),void 0)})}function G(){function D(){setTimeout(function(){var b,c,d;w[x]=A(e[x],!0),a.append(w[x]),x==B-3&&q.show(),x==B-1?setTimeout(function(){h[0].scrollTop=3*g},100):h[0].scrollTop=3*g,3==x&&f.html("家族群(10)"),x++,x==B&&(b=a.find(".wx_link"),b.append('<div class="hand down"><i class="fa fa-hand-o-down"></i></div>').on(click,function(){load()}),b.find(".hand").show(),t=$(".page6 .hand"),ajaxLock=!1,c=u(),d='<li class="group"><a href="javascript:;"><div class="headimg"><img src="img/hg.jpg"/></div><div class="mesbox"><p class="nickname">家族群</p><p class="message">弟弟:[链接]我在长大，你却老了</p></div><div class="mestime">'+c.hour+":"+c.min+"</div>"+"</a>"+"</li>",$wx_mes.prepend(d)),B>x&&"right"!=e[x].type&&D()},e[x].time)}if(y.apply(this,i[4]),1==r[6])return ajaxLock=!1,!1;r[6]=1;var a=$(".page6 .wx_mes ul"),b=$(".page6 .wxheader"),d=b.find(".goback"),f=b.find(".title"),h=$(".page6 .wxbody"),j=$(".page6 .wxfooter"),k=j.find(".mes"),l=j.find(".messmall"),m=j.find(".mesbig"),n=j.find(".mesinput"),o=j.find(".mesbtn"),q=(b.find(".hand"),l.find(".hand")),s=o.find(".hand"),t=$(".page6 .hand"),w=[],x=0,B=e.length;h.height(g-$header.height()-b.height()-j.height()),c.push({name:"爷爷",img:8,msg:"我是爷爷！"}),D(),l.on(click,function(){return x>=B?!1:"right"!=e[x].type?!1:(s.show(),k.removeClass("current"),m.addClass("current"),n.html(e[x].msg).css("line-height",n.height()+"px"),void 0)}),o.on("click",function(){return"right"!=e[x].type?!1:(t.hide(),w[x]=A(e[x]),a.append(w[x]),h[0].scrollTop=3*g,k.removeClass("current"),l.addClass("current"),n.empty(),++x>=B?!1:(D(),void 0))}),d.on(click,function(){return t.hide(),ajaxLock?!1:(z(!0),C(!0),void 0)})}function H(){v(),B(),k=setInterval(v,m)}var k,a=createjs,b=["p1_bg.jpg","p1_t1.png","p1_t2.png","footer.jpg","p2_t1.png","p3_t1.jpg","p3_t2.jpg","p3_t3.png","p4_t1.jpg","wxshare.png","h0.jpg","h1.jpg","h2.jpg","h3.jpg","h4.jpg","h5.jpg","h6.jpg","h7.jpg","h8.jpg","hm.jpg"],c=[{name:"我",img:"m"},{name:"爸爸",img:0,msg:"儿子，在不在？"},{name:"二姑",img:1,msg:"过儿，姑姑在这儿。。。"},{name:"小婶",img:2,msg:"你叔呢？"},{name:"妹妹",img:3,msg:"我是你妹！"},{name:"弟弟",img:4,msg:"哥。给我买个iPhone 6s！"},{name:"小叔",img:5,msg:"你婶呢？"},{name:"姐姐",img:6,msg:"小青。让仕林小心！"},{name:"二姑夫",img:7,msg:"我给你打点儿钱吧！"}],d=[{type:"time"},{type:"left",headimg:0,msg:"儿子，在不在？",time:0},{type:"right",headimg:"m",msg:"怎么了？"},{type:"left",headimg:0,msg:"刚教会你爷爷玩微信，想建个群给家里人都拉进来。",time:1e3},{type:"right",headimg:"m",msg:"哇，爷爷好新潮！那我直接建立吧！"}],e=[{type:"time",msg:"你邀请了爸爸,二姑,妹妹...参与群聊",time:0},{type:"time",time:500},{type:"left",headimg:4,msg:"哇！",time:700},{type:"time",msg:"爸爸邀请青松进入家庭群",time:1e3},{type:"time",time:500},{type:"left",headimg:0,msg:"呵呵，爸来了！",time:800},{type:"left",headimg:8,msg:"大家好！",time:1e3},{type:"left",headimg:3,msg:"列队欢迎！",time:1200},{type:"left",headimg:1,msg:"棒！",time:500},{type:"left",headimg:2,msg:"爸重阳节快乐！",time:700},{type:"left",headimg:6,msg:"爷爷好！",time:700},{type:"left",headimg:4,msg:"爷爷好！",time:900},{type:"left",headimg:7,msg:"重阳节到了，祝爸爸身体健康！！",time:900},{type:"right",headimg:"m",msg:"爷爷好！棒棒哒！"},{type:"left",headimg:4,msg:'<img src="img/wxshare.png" class="wxshare"/>',time:1e3,link:"http://x.eqxiu.com/s/Nz8aK8py"}],f=$(window).width(),g=$(window).height(),h={begin:0,day:0,min:0},i=[[1,2,3],[2,3,4],[3,4,5],[4,5,6],[2,6],[1,2,6]],j=.5*f,l=-1,m=1e4,n=77,o=7,p=1,q=500,r=[0,0,0,0,0,0,0];$header=$("#header"),$time=$(".time"),$date=$(".date"),$nettype=$(".nettype"),$signal=$(".signal"),$powernum=$header.find(".powernum"),$powerProgress=$header.find(".powerProgress"),$page={page:$(".page"),page1:$(".page1"),page2:$(".page2"),page3:$(".page3"),page4:$(".page4"),page5:$(".page5"),page6:$(".page6")},$progress=$("#progress"),$drag=$(".drag"),$wxheader=$(".wxheader"),$wx_mes=$(".wx_meslist ul"),preload=new a.LoadQueue(!1,"img/"),preload.loadManifest(b),preload.on("fileload",s),preload.on("complete",H)});