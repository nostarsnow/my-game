$(function(){function e(e){$progress.html((100*preload.progress).toFixed(2)+"%")}function i(){var e=new Date,i=e.getMonth()+1,a=e.getDate(),t=e.getHours(),s=e.getMinutes();return{month:i>9?i:"0"+i,day:a>9?a:"0"+a,hour:t>9?t:"0"+t,min:s>9?s:"0"+s,week:e.getDay()}}function a(){var e=i();0==C.begin&&(C.begin=e),_++,M>=D&&_%P==0&&($powernum.html(M+"%"),$powerProgress.width(M+"%"),M--),C.min!=e.min&&(C.min=e.min,$time.html(e.hour+":"+e.min)),C.day!=e.day&&(C.day=e.day,$date.html(e.month+"月"+e.day+"日 星期"+"日一二三四五六"[e.week]))}function t(){$drag.on("touchstart",function(e){if(this.moving)return!1;$(this).hasClass("message")&&$(this).addClass("movedown"),this.moving=!0,this.bx=e.touches[0].pageX}),$drag.on("touchmove",function(e){if(!this.moving)return!1;var i=e.touches[0].pageX,a=i-this.bx;if(a>L)return this.moving=!1,m(),!1;a>0&&$(this).css("left",a)}),$drag.on("touchend",function(e){this.moving=!1,$(this).removeClass("movedown").animate({left:0},300)})}function s(){for(var e=w.slice(2),i=[],a=0,t=e.length;a<t;a++)i.push(e.splice(Math.floor(Math.random()*e.length),1)[0]);for(var s,n,a=0,t=i.length,g=[],o=new Date;a<t;a++)o.setMinutes(C.begin.min-~~(a*Math.random()*17+11)),o.setHours(C.begin.hour-1.5*a),s=o.getHours(),s<10&&(s="0"+s),n=o.getMinutes(),n<10&&(n="0"+n),g.push('<li><a href="javascript:;"><div class="headimg"><img src="img/h'+i[a].img+'.jpg"/></div><div class="mesbox"><p class="nickname">'+i[a].name+'</p><p class="message">'+i[a].msg+'</p></div><div class="mestime">'+s+":"+n+"</div></a></li>");$wx_mes.append(g.join(""))}function n(e,i,a){$page.page.removeClass("current"),$(".list").removeClass(function(e,i){return(i.match(/list(-.*)?/g)||[]).join(" ")}).removeClass("current"),e&&$page["page"+e].addClass("current list list--1"),i&&$page["page"+i].addClass("current list list-0"),a&&$page["page"+a].addClass("current list list-1")}function g(e){var i=$(".list--1"),a=$(".list-0"),t=$(".list-1");e?(t.removeClass("current list--1"),a.removeClass("list-0").addClass("list-1"),i.removeClass("list--1").addClass("list-0")):(i.removeClass("current list--1"),a.removeClass("list-0").addClass("list--1"),t.removeClass("list-1").addClass("list-0"))}function o(e,a){var t,s=e.type,n=e.headimg,g=e.msg,o="",d=e.link;if("time"==s){if(t='<li class="mes_time"><span>',g)t+=g;else{var m=i();t+=m.hour+":"+m.min}t+="</span></li>"}else a&&(o='<div class="nickname">'+w[n+1].name+"</div>"),t='<li class="mes_'+s+'">'+(e.link?'<a href="'+d+'" class="wx_link">':'<a href="javascript:;">')+'<div class="headimg"><img src="img/h'+n+'.jpg"/></div>'+o+'<div class="mesbox">'+g+"</div></a></li>";return t}function d(){X[1]=1,$page.page.removeClass("current"),$page.page1.addClass("current"),t(),$signal.each(function(e,i){!function(e){setTimeout(function(){$(i).addClass("full")},300*e)}(e)}),navigator.userAgent.match(/wifi/i)?$nettype.addClass("wifi"):$nettype.addClass("cmnet")}function m(e){if(ajaxLock=!1,e?n.apply(this,b[5]):n.apply(this,b[0]),1==X[2])return ajaxLock=!1,!1;X[2]=1;var i=$(".page2 .wxheader"),a=$(".page2 .wxbody"),t=$(".page2 .wxfooter"),o=a.find(".daddy"),d=o.find(".hand");a.height(j-$header.height()-i.height()-t.height()),o.find(".mestime").html(C.begin.hour+":"+C.begin.min),d.show(),s(),o.on(click,function(){if(ajaxLock)return!1;d.hide(),n.apply(this,b[0]),$(".page2 .daddy .newmes").hide(),ajaxLock=!0,g(),setTimeout(function(){r()},H)}),$wx_mes.on(click,".group",function(){if(ajaxLock)return!1;n.apply(this,b[5]),ajaxLock=!0,g(),setTimeout(function(){p()},H)})}function r(){function e(){setTimeout(function(){L[_]=o(x[_]),i.append(L[_]),C.html(x[_].msg),r[0].scrollTop=j,_++,2!=_&&4!=_||f.show(),_<T&&"right"!=x[_].type&&e()},x[_].time)}if(n.apply(this,b[1]),1==X[3])return ajaxLock=!1,!1;X[3]=1;var i=$(".page3 .wx_mes ul"),a=$(".page3 .wxheader"),t=a.find(".goback"),s=a.find(".right"),d=a.find(".hand"),r=$(".page3 .wxbody"),l=$(".page3 .wxfooter"),p=l.find(".mes"),c=l.find(".messmall"),f=c.find(".hand"),u=l.find(".mesbig"),v=l.find(".mesinput"),w=l.find(".mesbtn"),y=w.find(".hand"),k=$(".page3 .hand"),C=$(".page2 .daddy .message"),L=[],_=0,T=x.length;r.height(j-$header.height()-a.height()-l.height()),e(),t.on(click,function(){k.hide(),g(!0),m()}),c.on(click,function(){return!(_>=T)&&("right"==x[_].type&&(p.removeClass("current"),u.addClass("current"),y.show(),void v.html(x[_].msg).css("line-height",v.height()+"px")))}),w.on("click",function(){return"right"==x[_].type&&(k.hide(),L[_]=o(x[_]),i.append(L[_]),C.html(x[_].msg),r[0].scrollTop=j,p.removeClass("current"),c.addClass("current"),v.empty(),!(++_>T)&&(_==T?(d.show(),void(ajaxLock=!1)):void e()))}),s.on(click,function(){if(ajaxLock)return ns.tip("先和爸爸说几句话吧！"),!1;k.hide(),ajaxLock=!0,g(),setTimeout(function(){h()},H)})}function h(){if(n.apply(this,b[2]),ajaxLock=!1,1==X[4])return ajaxLock=!1,!1;var e=$(".page4 .wxheader .goback"),i=$("#adduser"),a=$(".adduser .hand");X[4]=1,a.show(),e.on(click,function(){a.hide(),g(!0),r()}),i.on(click,function(){if(ajaxLock)return!1;a.hide(),ajaxLock=!0,g(),setTimeout(function(){l()},H)})}function l(){if(n.apply(this,b[3]),1==X[5])return ajaxLock=!1,!1;X[5]=1;var e=$(".page5 .wxheader"),i=$(".page5 .wxbody"),a=e.find(".goback"),t=$(".page5 .wxfooter"),s=$(".wx_userselected"),o=$(".page5 .wx_userlist ul"),d=e.find(".right"),m=e.find(".hand");i.height(j-$header.height()-e.height()-t.height());for(var r=w.slice(2),l=[],c=0,f=r.length;c<f;c++)l.push(r.splice(Math.floor(Math.random()*r.length),1)[0]);for(var c=0,f=l.length,u=[];c<f;c++){var v;if(0==c)var v='<div class="hand up"><i class="fa fa-hand-o-up"></i></div>';else v="";u.push('<li><a href="javascript:;"><div class="selector"><i class="fa fa-circle-o"></i>'+v+'</div><div class="headimg"><img src="img/h'+l[c].img+'.jpg"/></div><div class="nickname">'+l[c].name+"</div></a></li>")}o.append(u.join(""));var x=(o.find(".hand").show(),$(".page5 .hand"));o.on(click,"li",function(){var e,i=$(this);u=[],x.hide(),i.toggleClass("selected"),e=o.find(".selected"),e.each(function(e,i){u[e]='<li><a href="javascript:;"><div class="headimg"><img src="'+$(i).find(".headimg img").attr("src")+'"/></div></a></li>'}),e.length==f?(m.show(),ajaxLock=!1,d.html("确定 ("+f+")").addClass("canClick")):(ajaxLock=!0,d.html("确定 ("+e.length+")").removeClass("canClick")),s.html(u.join(""))}),a.on(click,function(){x.hide(),g(!0),h()}),d.on(click,function(){if(ajaxLock||o.find(".selected").length!=f)return ns.tip("要把所有家人都选择进来哟！"),!1;x.hide(),ajaxLock=!0,p()})}function p(){function e(){setTimeout(function(){if(C[L]=o(y[L],!0),a.append(C[L]),L==_-3&&v.show(),L==_-1?setTimeout(function(){r[0].scrollTop=3*j},100):r[0].scrollTop=3*j,3==L&&d.html("家族群(10)"),++L==_){var t=a.find(".wx_link");t.append('<div class="hand down"><i class="fa fa-hand-o-down"></i></div>').on(click,function(){load()}),t.find(".hand").show(),k=$(".page6 .hand"),ajaxLock=!1;var s=i(),n='<li class="group"><a href="javascript:;"><div class="headimg"><img src="img/hg.jpg"/></div><div class="mesbox"><p class="nickname">家族群</p><p class="message">弟弟:[链接]我在长大，你却老了</p></div><div class="mestime">'+s.hour+":"+s.min+"</div></a></li>";$wx_mes.prepend(n)}L<_&&"right"!=y[L].type&&e()},y[L].time)}if(n.apply(this,b[4]),1==X[6])return ajaxLock=!1,!1;X[6]=1;var a=$(".page6 .wx_mes ul"),t=$(".page6 .wxheader"),s=t.find(".goback"),d=t.find(".title"),r=$(".page6 .wxbody"),h=$(".page6 .wxfooter"),l=h.find(".mes"),p=h.find(".messmall"),c=h.find(".mesbig"),f=h.find(".mesinput"),u=h.find(".mesbtn"),v=(t.find(".hand"),p.find(".hand")),x=u.find(".hand"),k=$(".page6 .hand"),C=[],L=0,_=y.length;r.height(j-$header.height()-t.height()-h.height()),w.push({name:"爷爷",img:8,msg:"我是爷爷！"}),e(),p.on(click,function(){return!(L>=_)&&("right"==y[L].type&&(x.show(),l.removeClass("current"),c.addClass("current"),void f.html(y[L].msg).css("line-height",f.height()+"px")))}),u.on("click",function(){return"right"==y[L].type&&(k.hide(),C[L]=o(y[L]),a.append(C[L]),r[0].scrollTop=3*j,l.removeClass("current"),p.addClass("current"),f.empty(),!(++L>=_)&&void e())}),s.on(click,function(){if(k.hide(),ajaxLock)return!1;g(!0),m(!0)})}function c(){a(),d(),f=setInterval(a,T)}var f,u=createjs,v=["p1_bg.jpg","p1_t1.png","p1_t2.png","footer.jpg","p2_t1.png","p3_t1.jpg","p3_t2.jpg","p3_t3.png","p4_t1.jpg","wxshare.png","h0.jpg","h1.jpg","h2.jpg","h3.jpg","h4.jpg","h5.jpg","h6.jpg","h7.jpg","h8.jpg","hm.jpg"],w=[{name:"我",img:"m"},{name:"爸爸",img:0,msg:"儿子，在不在？"},{name:"二姑",img:1,msg:"过儿，姑姑在这儿。。。"},{name:"小婶",img:2,msg:"你叔呢？"},{name:"妹妹",img:3,msg:"我是你妹！"},{name:"弟弟",img:4,msg:"哥。给我买个iPhone 6s！"},{name:"小叔",img:5,msg:"你婶呢？"},{name:"姐姐",img:6,msg:"小青。让仕林小心！"},{name:"二姑夫",img:7,msg:"我给你打点儿钱吧！"}],x=[{type:"time"},{type:"left",headimg:0,msg:"儿子，在不在？",time:0},{type:"right",headimg:"m",msg:"怎么了？"},{type:"left",headimg:0,msg:"刚教会你爷爷玩微信，想建个群给家里人都拉进来。",time:1e3},{type:"right",headimg:"m",msg:"哇，爷爷好新潮！那我直接建立吧！"}],y=[{type:"time",msg:"你邀请了爸爸,二姑,妹妹...参与群聊",time:0},{type:"time",time:500},{type:"left",headimg:4,msg:"哇！",time:700},{type:"time",msg:"爸爸邀请青松进入家庭群",time:1e3},{type:"time",time:500},{type:"left",headimg:0,msg:"呵呵，爸来了！",time:800},{type:"left",headimg:8,msg:"大家好！",time:1e3},{type:"left",headimg:3,msg:"列队欢迎！",time:1200},{type:"left",headimg:1,msg:"棒！",time:500},{type:"left",headimg:2,msg:"爸重阳节快乐！",time:700},{type:"left",headimg:6,msg:"爷爷好！",time:700},{type:"left",headimg:4,msg:"爷爷好！",time:900},{type:"left",headimg:7,msg:"重阳节到了，祝爸爸身体健康！！",time:900},{type:"right",headimg:"m",msg:"爷爷好！棒棒哒！"},{type:"left",headimg:4,msg:'<img src="img/wxshare.png" class="wxshare"/>',time:1e3,link:"http://x.eqxiu.com/s/Nz8aK8py"}],k=$(window).width(),j=$(window).height(),C={begin:0,day:0,min:0},b=[[1,2,3],[2,3,4],[3,4,5],[4,5,6],[2,6],[1,2,6]],L=.5*k,_=-1,T=1e4,M=77,D=7,P=1,H=500,X=[0,0,0,0,0,0,0];$header=$("#header"),$time=$(".time"),$date=$(".date"),$nettype=$(".nettype"),$signal=$(".signal"),$powernum=$header.find(".powernum"),$powerProgress=$header.find(".powerProgress"),$page={page:$(".page"),page1:$(".page1"),page2:$(".page2"),page3:$(".page3"),page4:$(".page4"),page5:$(".page5"),page6:$(".page6")},$progress=$("#progress"),$drag=$(".drag"),$wxheader=$(".wxheader"),$wx_mes=$(".wx_meslist ul"),preload=new u.LoadQueue(!1,"img/"),preload.loadManifest(v),preload.on("fileload",e),preload.on("complete",c)});