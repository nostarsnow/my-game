"use strict";$(function(){function t(){d.removeClass("current"),g.addClass("current"),J=0,H=0,K=40,E.html(K),w.html(""),M.html(""),L.empty().removeClass("right error").addClass("empty"),Q=z.slice(0),V=[],W=[];for(var t=0,a=Q.length;t<a;t++)V.push(Q.splice(Math.floor(Math.random()*Q.length),1)[0]);h=setInterval(i,10),e()}function e(){ns.load();var t=V[J].text.slice(0),e=[];j.attr("src","img/ans"+V[J].img+".png"),y.html(J+1);for(var a=0,n=t.length,s=[];a<n;a++){var r=t.splice(Math.floor(Math.random()*t.length),1)[0];s[a]='<span style="height:'+P+'" data-pos='+a+">"+r+"</span>",e.push(r)}T.html(s.join("")),W.push(e),ns.loadHide()}function a(){var t=[],a=!0;L.each(function(e,a){t.push($.trim($(a).html()))});for(var n=0,s=t.length;n<s;n++)t[n]!=V[J].right[n]&&(a=!1,L.eq(n).addClass("error"));a&&(ns.ajaxLock=!0,L.removeClass("error").addClass("right"),setTimeout(function(){if(9==J)return ns.ajaxLock=!1,clearInterval(h),o(),!1;J++,L.empty().removeClass("right error").addClass("empty"),e(),ns.ajaxLock=!1},500))}function n(){t(),T.on(click,"span",function(){if(ns.ajaxLock)return!1;var t=$(this);if(t.hasClass("empty"))return!1;var e=t.data("pos"),n=$.trim(t.html()),s=C.find(".empty"),r=s.length;if(0==r)return!1;L.eq(s.eq(0).index()).html(n).data("pos",e).removeClass("empty"),t.addClass("empty").empty(),r-1==0&&a()}),_.on("click",function(){if(0==K)return ns.tip("提示次数已用完！要靠你自己了！"),!1;if(ns.ajaxLock)return!1;var t=C.find(".empty"),e=t.length;if(0==e)return!1;var n=(t.eq(0),Math.floor(Math.random()*e)),s=t.eq(n),r=t.eq(n).index(),i=V[J].right[r],o=W[J].indexOf(i);E.html(--K),s.html(i).data("pos",o).removeClass("empty"),T.find("span").eq(o).addClass("empty").empty(),e-1==0&&a()}),L.on(click,function(){if(ns.ajaxLock)return!1;var t=$(this);if(t.hasClass("empty"))return!1;var e=t.data("pos"),a=t.html();t.addClass("empty").removeClass("error").empty(),T.find("span").eq(e).html(a).removeClass("empty")})}function s(){d.removeClass("current"),f.addClass("current")}function r(t){var e=~~(t%100);return~~(t/100)+" '' "+(e<10?"0"+e:e)}function i(){v.html(r(++H))}function o(){w.html(r(H)),M.html(myBestRank),s()}function c(){reged?l():$log({type:"reg",go:function(){var t=$("#name").val(),e=$("#tel").val();return!!check.name(t)&&(!!check.tel(e)&&(!ns.ajaxLock&&(ns.ajaxLock=!0,ns.load(),void $.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl="+Math.random().toFixed(3),data:{action:"reg",name:t,active:active,tel:e,openid:openid},dataType:check.ajaxDataType,success:function(a){ns.load(),ns.ajaxLock=!1,console.log(a),0==a.errcode?(myName=t,myTel=e,reged=!0,m()):ns.tip(a.errmsg)},error:function(){ns.load(),ns.ajaxLock=!1,ns.tip(check.ajaxError)}}))))}})}function l(){H>0?t():n()}function p(){if(ns.ajaxLock)return!1;ns.ajaxLock=!0,ns.load(),$.ajax({url:check.ajaxUrl+"?xl_r="+Math.random().toFixed(3),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"queryList",pageIndex:N,pageSize:O,active:active},success:function(t){if(ns.load(),ns.ajaxLock=!1,console.log(t),0==t.errcode){var e=t.list,a=e.length,n="";if(a>0){N++;for(var s=0;s<a;s++)A++,n+='<li><span class="rank_num">'+A+'</span><span class="rank_name">'+e[s].name+'</span><span class="rank_score">'+(e[s].time?r(e[s].time):0)+"</span></li>";B.append(n)}else G=!0}else ns.tip(check.ajaxError)},error:function(){ns.load(),ns.ajaxLock=!1,ns.tip(check.ajaxError)}})}function m(t){$.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl_r="+Math.random().toFixed(3),data:{action:"queryInfo",active:active,openid:openid,info:7777},dataType:check.ajaxDataType,success:function(t){console.log(t),ns.load(),0==t.errcode?(H>0?ns.tip("更新成功！"):(ns.tip("注册成功！",1e3),$("#xl_dialog").remove(),l()),enKey=t.key,enIv=t.iv,H>0&&(w.html(r(t.time)),M.html(t.rank)),myBestScore=t.time||0,myBestRank=t.rank,I.html(r(t.time)||0),R.html(myBestRank)):ns.tip(t.errmsg)},error:function(){ns.tip(check.ajaxError)}})}var h,d=($(window),$(".page")),u=$(".page1"),g=$(".page2"),f=$(".page3"),x=($(".page4"),$("#btn_start")),k=$(".btn_rank"),y=$("#ansCur"),v=($("#ansTotal"),$("#time")),j=$("#ansImg"),C=$(".ansRight"),L=C.find("span"),T=$(".ansSelect"),_=($("#btn_next"),$("#btn_tip")),b=$("#btn_restart"),k=$(".btn_rank"),q=$("#rank"),B=q.find("ul"),M=$("#myRank"),w=$("#myScore"),I=$("#myBestScore"),R=$("#myBestRank"),S=$(".close"),E=($("#tipCur"),$("#tipTime")),D=$(".adb"),F=$(".adb_close"),U=.8*$(window).width(),z=($(window).height(),[{img:"1",text:"杏让火枣交孩老夫祸花雨子梨弟兄之孔付眉童孙上犁仔绒谦云融小利园发".split(""),right:"孔融让梨".split("")},{img:"2",text:"冰雪铺地银装霜花阳白门封路天冻舞立堆尺大飞飘交加前遍玉城程皑瑞雾".split(""),right:"程门立雪".split("")},{img:"3",text:"吹食乞怜乘儿火哀束蕴告穷赖箫嗟搓之物碗饭箪给讨餐得酒来老叟热摇尾".split(""),right:"嗟来之食".split("")},{img:"4",text:"室食肝采玉席桂薪牧枕块越勾竹犊反负卧坐悬脏空堂尝但抽止积火胆差剑".split(""),right:"卧薪尝胆".split("")},{img:"5",text:"尝不雪梁借专映卧孜倦莹胆悬锥寒窗忘废食心致知绑刺寝股读志向苦灯夜".split(""),right:"悬梁刺股".split("")},{img:"6",text:"言失得金行百久字诺若佑黄斤不鼎既出一为定待以大约布重信承千名九季".split(""),right:"一诺千金".split("")},{img:"7",text:"愚不可及者千虑眉肉眼移根换叶风俗易石世易公老山私怂恿禺绳框绿担屋".split(""),right:"愚公移山".split("")},{img:"8",text:"凿人书学凳墙砖翻壁石洞孔透坐偷看亮瑜璧光来砸造灯函穿过凶愉元羌输".split(""),right:"凿壁偷光".split("")},{img:"9",text:"牛甭书生羊卷尖动桂角画孩墨布纸童坐看地头挂佳汗犊齿足牵悬起人郎儿".split(""),right:"牛角挂书".split("")},{img:"10",text:"手服古不酒二野村八贵店而抬洒庄家华是手夺目树毕本宝好符过实其异人".split(""),right:"华而不实".split("")}]),H=0,K=40,N=1,O=50,A=0,G=!1,J=0,P=.125*U+"px",Q=z.slice(0),V=[],W=[];!function(){C.css("line-height",.2*U+"px"),L.css("height",.2*U+"px"),T.css("line-height",P),I.html(r(myBestScore)||0),R.html(myBestRank)}(),k.on(click,function(){ns.tip("暂无排行！")}),b.on(click,function(){l()}),q.scroll(function(){!G&&!ns.ajaxLock&&B.height()-q.height()-q.scrollTop()<20&&p()}),S.on(click,function(){d.removeClass("current"),0==H?u.addClass("current"):f.addClass("current")}),x.on(click,c),F.on(click,function(){D.hide(300)});var X=document.getElementById("bgmp3"),Y=!1;$(document).on("touchstart",function(){Y?X.play():!1!==X.paused&&(X.load(),Y=!0,X.play()),$(document).unbind("touchstart")})});