!function(){function e(){y.html("100%"),w.show(),S.removeClass("xl_loding_show"),ns.loadHide(),y.html("Loading..."),n()}function n(){TIME=0,timeGo=null,STOP=0,STOP_PRO=.2,STOP_TIME=2e3,upSpeed=1e3,downSpeed=1e3,waitTime=500,nextTime=2e3,handSpeed=100,animType="linear",GAME=null,SCORE=0,TIME=0,TOTAL=0,lastDeviceGet=0,laveTime=4,laveTimeGo=null,TITLE=[{name:"打鼠小能手",img:"img/s1.png"},{name:"灭鼠小行家",img:"img/s2.png"},{name:"打地鼠超人",img:"img/s3.png"}],TITLEGET=null}function a(){if(j.show(),--laveTime<0)return j.hide(),o(),startTime=(new Date).getTime(),void clearInterval(laveTimeGo);j.html('<img src="img/num'+laveTime+'.png"/>')}function t(){i()}function i(){T*=.9,h*=.5,holl_set={w:.3*T,h:20,row:3,col:3,count:9},html="";for(var e=0;e<holl_set.row;e++)for(var n=0;n<holl_set.col;n++)html+='<div class="box"><img src="img/man0.png" class="mouse down"/><img src="img/logo.png" class="logo down"/></div>';I.html(html),$box=$(".box"),$mouse=$(".mouse"),$logo=$(".logo"),$mouse.on(click,function(e){var n=$(this);if(!n.hasClass("hited")){n.addClass("hited");var a=$("<img/>").addClass("hand").attr("src",sources.hand).css({top:e.target.y,left:e.target.x}).appendTo(G);a.animate({translate:"30%,-20%",rotate:0},handSpeed,animType,function(){n.attr("src",sources.man1),b.html(++SCORE),a.animate({opacity:0},handSpeed,animType,function(){a.remove()})})}}),$logo.on(click,function(e){STOP++,ns.tip("你敢打我！我妈都没打过我。！",2e3),z.show(),setTimeout(function(){z.fadeOut(300)},STOP_TIME-300);var n=$("<img/>").addClass("hand").attr("src",sources.hand).css({top:e.target.y,left:e.target.x}).appendTo(G);n.animate({translate:"30%,-20%",rotate:0},handSpeed,animType,function(){n.animate({opacity:0},handSpeed,animType,function(){n.remove()})})})}function o(){clearInterval(timeGo),timeGo=setInterval(function(){_.html(++TIME)},1e3),r(),GAME=setInterval(l,nextTime)}function l(){if(SCORE>=30)return SCORE,c(),void clearInterval(GAME);if(5==SCORE)upSpeed=700,downSpeed=700,waitTime=500,nextTime=1300,clearInterval(GAME),GAME=setInterval(l,nextTime);else if(10==SCORE)upSpeed=500,downSpeed=500,waitTime=300,nextTime=700,clearInterval(GAME),GAME=setInterval(l,nextTime);else if(15==SCORE)upSpeed=300,downSpeed=300,waitTime=300,nextTime=500,clearInterval(GAME),GAME=setInterval(l,nextTime);else if(20==SCORE)upSpeed=300,downSpeed=300,waitTime=200,nextTime=300,clearInterval(GAME),GAME=setInterval(l,nextTime);else if(25==SCORE)upSpeed=100,downSpeed=100,waitTime=100,nextTime=200,clearInterval(GAME),GAME=setInterval(l,nextTime);else if(SCORE>=30)return SCORE,c(),void clearInterval(GAME);TOTAL++,r()}function r(){var e,n=Math.random(),a=$(".mouse.down"),t=a.length,i=Math.floor(Math.random()*t);n<=STOP_PRO?(e=$(".logo.down").eq(i),e.attr("src",sources.logo)):(e=a.eq(i),e.attr("src",sources.man0)),e.removeClass("down hited").addClass("up").animate({bottom:0},upSpeed,animType,function(){setTimeout(function(){e.animate({bottom:"-110%"},downSpeed,animType,function(){e.removeClass("up").addClass("down")})},waitTime)})}function c(){endTime=(new Date).getTime();var e=((endTime-startTime)/1e3).toFixed(2);TITLEGET=e<50?2:e<90?1:0,(e<myBestTime||0==myBestTime)&&m(e),clearInterval(timeGo),P.attr("src",TITLE[TITLEGET].img),R.html(TITLE[TITLEGET].name),C.removeClass("current"),O.addClass("current"),ns.numberTo(A,SCORE,3,100),ns.numberTo(L,e,3,100)}function s(){$.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl="+Math.random().toFixed(3),data:{action:"queryInfo",active:active,openid:openid},dataType:check.ajaxDataType,success:function(e){console.log(e),0==e.errcode?(K.html(e.rank),U.html(e.time)):alert(e.errmsg)},error:function(){ns.tip(check.ajaxError)}})}function m(e){enKey&&enIv&&(load(),$.ajax({url:check.ajaxUrl+"?rand="+Math.random(),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"addDetail",active:active,openid:openid,score:SnowCryEncrypt(SCORE,enKey,enIv),time:SnowCryEncrypt(e,enKey,enIv)},success:function(e){console.log(e),0==e.errcode&&(s(),ns.tip("更新成功！")),ns.loadHide()},error:function(){ns.tip(check.ajaxError),ajaxLock=0}}))}function d(){load(),$.ajax({url:"conn/ajax.php?xl_r="+Math.random(),type:"POST",dataType:"json",data:{action:"queryList",pageIndex:v,pageSize:f,active:active},success:function(e){if(ns.loadHide(),console.log(e),0==e.errcode){ajaxLock=!1;var n=e.list,a=n.length,t="";if(a>0){v++;for(var i=0;i<a;i++)x++,t+='<li><span class="rank_num">'+x+'</span><span class="rank_name">'+n[i].name+'</span><span class="rank_score">'+(n[i].time||0)+"</span></li>";B.append(t)}else E=!0}}})}function p(){C.removeClass("current"),G.addClass("current"),laveTimeGo=setInterval(a,1e3),t(),a()}var u=[],g=function(e,n){var a=0,t=0;for(var i in e)t++;for(var i in e)/.mp3/.test(e[i])?(u[i]=new Audio(e[i]),u[i].load(),++a>=t&&n()):(u[i]=new Image,u[i].onload=function(){y.html((a/t*100).toFixed(2)+"%"),++a>=t&&n()},u[i].src=e[i])};ns.load();var T=$(window).width()>640?640:$(window).width(),h=$(window).height(),v=1,f=50,x=0,E=!1,y=$("#xl_loading_p"),S=$("#xl_loading"),w=$("#main"),I=$("#canvas"),k=$("#btn_go"),C=$(".page"),M=$(".page1"),G=$(".page2"),O=$(".page3"),j=($(".page4"),$("#lavetime")),_=$("#goingTime"),b=$("#goingScore"),A=$("#score"),R=$("#title"),L=$("#time"),P=$("#showTitle"),D=($("#btn_action"),$(".btn_rank")),H=$(".btn_restart"),q=$(".rankTop"),F=$("#rank"),B=F.find("ul"),K=$("#myRank"),U=$("#myScore"),z=$("#stop");window.onload=function(){sources={man0:"img/man0.png",man1:"img/man1.png",logo:"img/logo.png",hand:"img/hand.png",bg:"img/bg.jpg",t1:"img/t1.png",num0:"img/num0.png",num1:"img/num1.png",num2:"img/num2.png",num3:"img/num3.png"},g(sources,e)},k.on(click,function(){if(1==reged)return void p();$log({title:"让你的朋友知道你吧！",con:'<div class="tip">请输入您的真实姓名和手机号！</div><label class="in_ic40"><span class="l"><i class="fa fa-user"></i></span><span class="r"><input type="text" placeholder="请输入姓名" id="name" name="name" maxlength="12"/></span></label><label class="in_ic40"><span class="l"><i class="fa fa-mobile"></i></span><span class="r"><input type="tel" placeholder="请输入手机号码" id="tel" name="tel" maxlength="11"/></span></label>',go:function(){var e=$("#name").val(),n=$("#tel").val();return!!check.name(e)&&(!!check.tel(n)&&(load(),void $.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl="+Math.random().toFixed(3),data:{action:"reg",name:e,active:active,tel:n,openid:openid},dataType:check.ajaxDataType,success:function(a){0==a.errcode?(myName=e,myTel=n,reged=1,ns.tip("注册成功！"),location.href="index.html"):ns.tip(a.errmsg),ns.loadHide()},error:function(){ns.loadHide(),ns.tip(check.ajaxError)}})))}})}),D.on(click,function(){ns.tip("暂无排行!")}),H.on(click,function(){SCORE>0||TIME>0?location.href="index.html":(C.removeClass("current"),M.addClass("current"))}),F.scroll(function(e){!E&&!ajaxLock&&B.height()-F.height()-F.scrollTop()<20&&(ajaxLock=!0,d())}),q.on(click,function(){H.trigger(click)});var N=document.getElementById("bgmp3"),J=!1;$(document).on("touchstart",function(){J?N.play():!1!==N.paused&&(N.load(),J=!0,N.play()),$(document).unbind("touchstart")})}();