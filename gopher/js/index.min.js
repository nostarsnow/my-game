(function(){var w=[],u=function(Z,ab){var W=0;var H=0;for(var aa in Z){H++}for(var aa in Z){if(/.mp3/.test(Z[aa])){W;w[aa]=new Audio(Z[aa]);w[aa].load();if(++W>=H){ab()}continue}w[aa]=new Image();w[aa].onload=function(){K.html((W/H*100).toFixed(2)+"%");if(++W>=H){ab()}};w[aa].src=Z[aa]}};var c=$(window).width()>640?640:$(window).width(),j=$(window).height(),b=1,D=50,x=0,g=false,K=$("#xl_loading_p"),a=$("#xl_loading"),i=$("#main"),l=$("#canvas"),n=$("#btn_go"),f=$(".page"),s=$(".page1"),q=$(".page2"),o=$(".page3"),m=$(".page4"),d=$("#lavetime"),F=$("#goingTime"),S=$("#goingScore"),J=$("#score"),e=$("#title"),Y=$("#time"),M=$("#showTitle"),t=$("#btn_action"),G=$(".btn_rank"),y=$(".btn_restart"),R=$(".rankTop"),N=$("#rank"),k=N.find("ul"),L=$("#myRank"),r=$("#myScore"),A=$("#stop");window.onload=function(){sources={man0:"img/man0.png",man1:"img/man1.png",logo:"img/logo.png",hand:"img/hand.png",bg:"img/bg.jpg",t1:"img/t1.png",num0:"img/num0.png",num1:"img/num1.png",num2:"img/num2.png",num3:"img/num3.png"};u(sources,E)};function E(){K.html("100%");i.show();a.removeClass("xl_loding_show");load_h();K.html("Loading...");Q()}function Q(){TIME=0;timeGo=null;STOP=0;STOP_PRO=0.2;STOP_TIME=2000;upSpeed=1000;downSpeed=1000;waitTime=500;nextTime=2000;handSpeed=100;animType="linear";GAME=null;SCORE=0;TIME=0;TOTAL=0;lastDeviceGet=0;laveTime=4;laveTimeGo=null;TITLE=[{name:"打鼠小能手",img:"img/s1.png"},{name:"灭鼠小行家",img:"img/s2.png"},{name:"打地鼠超人",img:"img/s3.png"}];TITLEGET=null}function X(){d.show();if(--laveTime<0){d.hide();p();startTime=new Date().getTime();clearInterval(laveTimeGo);return}d.html('<img src="img/num'+laveTime+'.png"/>')}function T(){P()}function P(){c=c*0.9;j=j*0.5;holl_set={w:c*0.3,h:20,row:3,col:3,count:9};html="";for(var W=0;W<holl_set.row;W++){for(var H=0;H<holl_set.col;H++){html+='<div class="box"><img src="img/man0.png" class="mouse down"/><img src="img/logo.png" class="logo down"/></div>'}}l.html(html);$box=$(".box");$mouse=$(".mouse");$logo=$(".logo");$mouse.on(click,function(Z){var ab=$(this);if(ab.hasClass("hited")){return}ab.addClass("hited");var aa=$("<img/>").addClass("hand").attr("src",sources.hand).css({top:Z.target.y,left:Z.target.x}).appendTo(q);aa.animate({translate:"30%,-20%",rotate:0},handSpeed,animType,function(){ab.attr("src",sources.man1);S.html(++SCORE);aa.animate({opacity:0},handSpeed,animType,function(){aa.remove()})})});$logo.on(click,function(Z){STOP++;$tip("你敢打我！我妈都没打过我。！",2000);A.show();setTimeout(function(){A.hide(300)},STOP_TIME-300);var aa=$("<img/>").addClass("hand").attr("src",sources.hand).css({top:Z.target.y,left:Z.target.x}).appendTo(q);aa.animate({translate:"30%,-20%",rotate:0},handSpeed,animType,function(){aa.animate({opacity:0},handSpeed,animType,function(){aa.remove()})})})}function p(){clearInterval(timeGo);timeGo=setInterval(function(){F.html(++TIME)},1000);h();GAME=setInterval(v,nextTime)}function v(){if(SCORE>=30){SCORE==30;B();clearInterval(GAME);return}if(SCORE==5){upSpeed=700;downSpeed=700;waitTime=500;nextTime=1300;clearInterval(GAME);GAME=setInterval(v,nextTime)}else{if(SCORE==10){upSpeed=500;downSpeed=500;waitTime=300;nextTime=700;clearInterval(GAME);GAME=setInterval(v,nextTime)}else{if(SCORE==15){upSpeed=300;downSpeed=300;waitTime=300;nextTime=500;clearInterval(GAME);GAME=setInterval(v,nextTime)}else{if(SCORE==20){upSpeed=300;downSpeed=300;waitTime=200;nextTime=300;clearInterval(GAME);GAME=setInterval(v,nextTime)}else{if(SCORE==25){upSpeed=100;downSpeed=100;waitTime=100;nextTime=200;clearInterval(GAME);GAME=setInterval(v,nextTime)}else{if(SCORE>=30){SCORE==30;B();clearInterval(GAME);return}}}}}}TOTAL++;h()}function h(){var H=Math.random(),aa=$(".mouse.down"),Z=aa.length,W=Math.floor(Math.random()*Z),ab;if(H<=STOP_PRO){ab=$(".logo.down").eq(W);ab.attr("src",sources.logo)}else{ab=aa.eq(W);ab.attr("src",sources.man0)}ab.removeClass("down hited").addClass("up").animate({bottom:0},upSpeed,animType,function(){setTimeout(function(){ab.animate({bottom:"-110%"},downSpeed,animType,function(){ab.removeClass("up").addClass("down")})},waitTime)})}function B(){endTime=new Date().getTime();var H=((endTime-startTime)/1000).toFixed(2);if(H<50){TITLEGET=2}else{if(H<90){TITLEGET=1}else{TITLEGET=0}}if(H<myBestTime||myBestTime==0){z(H)}clearInterval(timeGo);M.attr("src",TITLE[TITLEGET].img);e.html(TITLE[TITLEGET].name);f.removeClass("current");o.addClass("current");window.share.title="我刚用"+H+"秒消灭了"+SCORE+"只地鼠！获得了"+TITLE[TITLEGET].name+"称号！不服？来战！";numberTo(J,SCORE,3,100);numberTo(Y,H,3,100)}function O(){$.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl="+Math.random().toFixed(3),data:{action:"queryInfo",active:active,openid:openid},dataType:check.ajaxDataType,success:function(H){console.log(H);if(H.errcode==0){L.html(H.rank);r.html(H.time)}else{alert(H.errmsg)}},error:function(){$tip(check.ajaxError)}})}function z(H){if(!enKey||!enIv){return}load();$.ajax({url:check.ajaxUrl+"?rand="+Math.random(),type:check.ajaxType,dataType:check.ajaxDataType,data:{action:"addDetail",active:active,openid:openid,score:SnowCryEncrypt(SCORE,enKey,enIv),time:SnowCryEncrypt(H,enKey,enIv)},success:function(W){console.log(W);if(W.errcode==0){O();$tip("更新成功！")}load_h()},error:function(){$tip(check.ajaxError);ajaxLock=0}})}function V(){load();$.ajax({url:"conn/ajax.php?xl_r="+Math.random(),type:"POST",dataType:"json",data:{action:"queryList",pageIndex:b,pageSize:D,active:active},success:function(ab){load_h();console.log(ab);if(ab.errcode==0){ajaxLock=false;var aa=ab.list,Z=aa.length,W="";if(Z>0){b++;for(var H=0;H<Z;H++){x++;W+='<li><span class="rank_num">'+x+'</span><span class="rank_name">'+aa[H].name+'</span><span class="rank_score">'+(aa[H].time||0)+"</span></li>"}k.append(W)}else{g=true}}}})}function C(){load();$.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl="+Math.random().toFixed(3),data:{action:"checkTimes",active:active,openid:openid},dataType:check.ajaxDataType,success:function(H){console.log(H);if(H.errcode==0){f.removeClass("current");q.addClass("current");laveTimeGo=setInterval(X,1000);T();X()}else{alert(H.errmsg)}load_h()},error:function(){load_h();$tip(check.ajaxError)}})}n.on(click,function(){if(reged==1){C();return}$log({title:"让你的朋友知道你吧！",con:'<div class="tip">请输入您的真实姓名和手机号！</div><label class="in_ic40"><span class="l"><i class="fa fa-user"></i></span><span class="r"><input type="text" placeholder="请输入姓名" id="name" name="name" maxlength="12"/></span></label><label class="in_ic40"><span class="l"><i class="fa fa-mobile"></i></span><span class="r"><input type="tel" placeholder="请输入手机号码" id="tel" name="tel" maxlength="11"/></span></label>',go:function(){var W=$("#name").val(),H=$("#tel").val();if(!check.name(W)){return false}if(!check.tel(H)){return false}load();$.ajax({type:check.ajaxType,url:check.ajaxUrl+"?xl="+Math.random().toFixed(3),data:{action:"reg",name:W,active:active,tel:H,openid:openid},dataType:check.ajaxDataType,success:function(Z){if(Z.errcode==0){myName=W;myTel=H;reged=1;$tip("注册成功！");location.href="index.php"}else{$tip(Z.errmsg)}load_h()},error:function(){load_h();$tip(check.ajaxError)}})}})});G.on(click,function(){f.removeClass("current");m.addClass("current");k.find("li").not(".rank_title").remove();b=1;g=false;x=0;V()});y.on(click,function(){if(SCORE>0||TIME>0){location.href="index.php"}else{f.removeClass("current");s.addClass("current")}});N.scroll(function(H){if(!g&&!ajaxLock&&(k.height()-N.height()-N.scrollTop()<20)){ajaxLock=true;V()}});R.on(click,function(){y.trigger(click)});var U=document.getElementById("bgmp3"),I=false;$(document).on("touchstart",function(){if(!I){if(U.paused!==false){U.load();I=true;U.play()}}else{U.play()}$(document).unbind("touchstart")})}());
